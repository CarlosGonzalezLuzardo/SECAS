Server iniciado. VAMOS AL LOGIN
2018-04-17 14:08:18,971 oicServer:INFO PATH: "user_password"
2018-04-17 14:08:18,972 oicServer:INFO callback: <function make_auth_verify.<locals>.auth_verify at 0x7ff7afa239d8>
2018-04-17 14:08:18,972 oic.utils.authn.user:DEBUG verify(query=client_id%3DcbaWz5g0uezd%26acr_values%3DMULTI_AUTHN%26redirect_uri%3Dhttp%253A%252F%252Flocalhost%253A8666%252Fauthz_cb%26response_type%3Dcode%26scope%3Dopenid%2Bprofile%2Bemail%2Baddress%2Bphone%26nonce%3DuCRzFJZT2T3uOdeSvPUOKV2TluACQk5i%26state%3DQsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4&acr_values=%5B%27MULTI_AUTHN%27%5D&login=alejandro&password=<REDACTED>&form.commit=Submit)
2018-04-17 14:08:18,973 oic.utils.authn.user:DEBUG dict: {'acr_values': ["['MULTI_AUTHN']"], 'password': '<REDACTED>', 'query': ['client_id=cbaWz5g0uezd&acr_values=MULTI_AUTHN&redirect_uri=http%3A%2F%2Flocalhost%3A8666%2Fauthz_cb&response_type=code&scope=openid+profile+email+address+phone&nonce=uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i&state=QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4'], 'login': ['alejandro'], 'form.commit': ['Submit']}
2018-04-17 14:08:19,268 oic.utils.authn.user:DEBUG Password verification succeeded.
2018-04-17 14:08:19,269 oic.utils.authn.user:DEBUG kwargs: {'acr_values': ['MULTI_AUTHN'], 'nonce': ['uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i'], 'response_type': ['code'], 'scope': ['openid profile email address phone'], 'state': ['QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4'], 'client_id': ['cbaWz5g0uezd'], 'upm_answer': 'true', 'redirect_uri': ['http://localhost:8666/authz_cb']}
2018-04-17 14:08:19,281 oicServer:INFO PATH: "css/main.css"
2018-04-17 14:08:19,282 oicServer:INFO callback: <bound method Application.css of <__main__.Application object at 0x7ff7af9e57b8>>
USUARIO Y CONTRASEÃ‘A METIDOS
2018-04-17 14:08:58,122 oicServer:INFO PATH: "totp_login"
2018-04-17 14:08:58,122 oicServer:INFO callback: <function make_auth_verify.<locals>.auth_verify at 0x7ff7afa23a60>
2018-04-17 14:08:58,126 oic.utils.authn.user:DEBUG kwargs: {'acr_values': ['MULTI_AUTHN'], 'nonce': ['uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i'], 'response_type': ['code'], 'scope': ['openid profile email address phone'], 'state': ['QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4'], 'client_id': ['cbaWz5g0uezd'], 'upm_answer': 'true', 'redirect_uri': ['http://localhost:8666/authz_cb']}
2018-04-17 14:08:58,134 oicServer:INFO PATH: "authorization"
2018-04-17 14:08:58,134 oicServer:INFO callback: <bound method Application.authorization of <__main__.Application object at 0x7ff7af9e57b8>>
2018-04-17 14:08:58,134 oic.oauth2.provider:DEBUG Request: 'acr_values=MULTI_AUTHN&nonce=uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i&response_type=code&state=QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4&upm_answer=true&redirect_uri=http%3A%2F%2Flocalhost%3A8666%2Fauthz_cb&scope=openid+profile+email+address+phone&client_id=cbaWz5g0uezd'
2018-04-17 14:08:58,135 oic.oic:DEBUG Found 3 verify keys
2018-04-17 14:08:58,137 oic.oauth2.provider:DEBUG AuthzRequest: {'acr_values': 'MULTI_AUTHN', 'nonce': 'uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i', 'response_type': 'code', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'redirect_uri': 'http://localhost:8666/authz_cb', 'upm_answer': 'true', 'scope': 'openid profile email address phone', 'client_id': 'cbaWz5g0uezd'}
2018-04-17 14:08:58,140 oic.oic.provider:INFO authorization_request: {'acr_values': 'MULTI_AUTHN', 'nonce': 'uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i', 'response_type': 'code', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'redirect_uri': 'http://localhost:8666/authz_cb', 'upm_answer': 'true', 'scope': 'openid profile email address phone', 'client_id': 'cbaWz5g0uezd'}
2018-04-17 14:08:58,142 oic.oic.provider:DEBUG Picked AuthN broker for ACR MULTI_AUTHN: [(<oic.utils.authn.multi_auth.MultiAuthnMethod object at 0x7ff7b07414a8>, 'MULTI_AUTHN')]
2018-04-17 14:08:58,142 oic.utils.authn.user:DEBUG kwargs: {'max_age': 0, 'authorization': '<REDACTED>'}
2018-04-17 14:08:58,143 oic.oauth2.provider:INFO No active authentication
2018-04-17 14:08:58,144 oic.oic.provider:DEBUG - authenticated -
2018-04-17 14:08:58,144 oic.oic.provider:DEBUG AREQ keys: ['acr_values', 'nonce', 'response_type', 'scope', 'redirect_uri', 'upm_answer', 'state', 'client_id']
2018-04-17 14:08:58,145 oic.utils.sdb:DEBUG uid2sid: {'alejandro': ['d5d15df23962b97f5a3a96c3fc4b9e1f0cd2986f31ce4764cb030525']}
2018-04-17 14:08:58,145 oic.oauth2.provider:DEBUG - in authenticated() -
2018-04-17 14:08:58,145 oic.oauth2.provider:DEBUG response type: ['code']
2018-04-17 14:08:58,148 oic.oic.provider:INFO authorization response: {'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'client_id': 'cbaWz5g0uezd', 'code': '<REDACTED>', 'scope': 'openid profile email address phone', 'iss': 'https://localhost:8092/'}
2018-04-17 14:08:58,149 oic.oic.provider:DEBUG Redirected to: 'http://localhost:8666/authz_cb?state=QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4&client_id=cbaWz5g0uezd&iss=https%3A%2F%2Flocalhost%3A8092%2F&scope=openid+profile+email+address+phone&code=<REDACTED>' (<class 'str'>)
2018-04-17 14:08:58,167 oicServer:INFO PATH: "token"
2018-04-17 14:08:58,167 oicServer:INFO callback: <bound method Application.token of <__main__.Application object at 0x7ff7af9e57b8>>
2018-04-17 14:08:58,167 oic.oic.provider:DEBUG - token -
2018-04-17 14:08:58,168 oic.oic.provider:INFO token_request: grant_type=authorization_code&client_id=cbaWz5g0uezd&redirect_uri=http%3A%2F%2Flocalhost%3A8666%2Fauthz_cb&code=<REDACTED>&scope=openid+profile+email+address+phone&state=QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4
2018-04-17 14:08:58,168 oic.oic.provider:DEBUG AccessTokenRequest: {'grant_type': 'authorization_code', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'code': '<REDACTED>', 'client_id': 'cbaWz5g0uezd', 'scope': 'openid profile email address phone', 'redirect_uri': 'http://localhost:8666/authz_cb'}
2018-04-17 14:08:58,168 oic.utils.authn.client:DEBUG REQ: {'grant_type': 'authorization_code', 'code': '<REDACTED>', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'redirect_uri': 'http://localhost:8666/authz_cb', 'scope': 'openid profile email address phone', 'client_id': 'cbaWz5g0uezd'}
2018-04-17 14:08:58,168 oic.utils.authn.client:DEBUG Basic auth
2018-04-17 14:08:58,175 oic.oic.provider:DEBUG All checks OK
2018-04-17 14:08:58,176 oic.oic:DEBUG authzreq: {'acr_values': 'MULTI_AUTHN', 'nonce': 'uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i', 'response_type': 'code', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'scope': 'openid profile email address phone', 'client_id': 'cbaWz5g0uezd', 'upm_answer': 'true', 'redirect_uri': 'http://localhost:8666/authz_cb'}
2018-04-17 14:08:58,176 oic.oic.provider:DEBUG Signing alg: RS256 [RSA]
2018-04-17 14:08:58,176 oic.oic:DEBUG authzreq: {'acr_values': 'MULTI_AUTHN', 'nonce': 'uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i', 'response_type': 'code', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'scope': 'openid profile email address phone', 'client_id': 'cbaWz5g0uezd', 'upm_answer': 'true', 'redirect_uri': 'http://localhost:8666/authz_cb'}
2018-04-17 14:08:58,176 oic.oic.provider:DEBUG id_token: {'nonce': 'uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i', 'iat': 1523970538, 'iss': 'https://localhost:8092/', 'exp': 1524056938, 'aud': ['cbaWz5g0uezd'], 'auth_time': 1523970538, 'sub': 'a9010fd21a93c687b3c4c506313993b5a2ade87b719d09792b120a27b852f749', 'acr': 'MULTI_AUTHN'}
2018-04-17 14:08:58,176 jwkest.jws:DEBUG Picking key by key type=RSA
2018-04-17 14:08:58,176 jwkest.jws:DEBUG Picking key based on alg=RS256, kid=None and use=sig
2018-04-17 14:08:58,176 jwkest.jws:DEBUG Picked: kid:op1, use:sig, kty:RSA
2018-04-17 14:08:58,177 root:DEBUG JWT header: {'kid': 'op1', 'alg': 'RS256'}
2018-04-17 14:08:58,180 jwkest.jws:DEBUG Signed message using key with kid=op1
2018-04-17 14:08:58,181 oic.oic.provider:DEBUG _tinfo: {'id_token': 'eyJraWQiOiJvcDEiLCJhbGciOiJSUzI1NiJ9.eyJub25jZSI6ICJ1Q1J6RkpaVDJUM3VPZGVTdlBVT0tWMlRsdUFDUWs1aSIsICJpYXQiOiAxNTIzOTcwNTM4LCAiaXNzIjogImh0dHBzOi8vbG9jYWxob3N0OjgwOTIvIiwgImV4cCI6IDE1MjQwNTY5MzgsICJhdWQiOiBbImNiYVd6NWcwdWV6ZCJdLCAiYXV0aF90aW1lIjogMTUyMzk3MDUzOCwgInN1YiI6ICJhOTAxMGZkMjFhOTNjNjg3YjNjNGM1MDYzMTM5OTNiNWEyYWRlODdiNzE5ZDA5NzkyYjEyMGEyN2I4NTJmNzQ5IiwgImFjciI6ICJNVUxUSV9BVVRITiJ9.pBQdgc-WGWg9fDQ5wt2xNYhCk3A83A32oDp8xDy-BvUfzRxckDSz7sUQnam2fc5Ry60wvuD1WZSf574l9a2ALzaPIjt5eR1TG2ZO8-_2eLEyJMSRqTtwRHQwz0HpUQIv9Xzo-AAYNwLniECDFSBc73ddOEKe5-kfPr9JK6tlc9MC7gtX_-rRDYyS_rhA_maI9J_mDfE9m5Pv8eV9VtvrPYDrpMi7DBnMh5xKRTLjkm6awVDy26GKPv2IpQ7-uXgFxsTQYIP-mhElZpTEmj9TQjkFVnjvJO6LkdX7TwVh6wMFgkwgGC--Y-i7gqMgxuTK4wmhIB3CeScKUfrOqzzSEA', 'code': '<REDACTED>', 'access_token': '<REDACTED>', 'redirect_uri': 'http://localhost:8666/authz_cb', 'authzreq': '{"acr_values": "MULTI_AUTHN", "nonce": "uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i", "response_type": "code", "state": "QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4", "scope": "openid profile email address phone", "client_id": "cbaWz5g0uezd", "upm_answer": "true", "redirect_uri": "http://localhost:8666/authz_cb"}', 'oauth_state': 'token', 'sub': 'a9010fd21a93c687b3c4c506313993b5a2ade87b719d09792b120a27b852f749', 'code_used': True, 'nonce': 'uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i', 'revoked': False, 'response_type': ['code'], 'permission': '', 'authn_event': <oic.utils.sdb.AuthnEvent object at 0x7ff7af9c07f0>, 'scope': ['openid', 'profile', 'email', 'address', 'phone'], 'access_token_scope': '?', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'token_type': 'Bearer', 'client_id': 'cbaWz5g0uezd'}
2018-04-17 14:08:58,181 oic.oic.provider:INFO access_token_response: {'access_token': '<REDACTED>', 'scope': 'openid profile email address phone', 'id_token': 'eyJraWQiOiJvcDEiLCJhbGciOiJSUzI1NiJ9.eyJub25jZSI6ICJ1Q1J6RkpaVDJUM3VPZGVTdlBVT0tWMlRsdUFDUWs1aSIsICJpYXQiOiAxNTIzOTcwNTM4LCAiaXNzIjogImh0dHBzOi8vbG9jYWxob3N0OjgwOTIvIiwgImV4cCI6IDE1MjQwNTY5MzgsICJhdWQiOiBbImNiYVd6NWcwdWV6ZCJdLCAiYXV0aF90aW1lIjogMTUyMzk3MDUzOCwgInN1YiI6ICJhOTAxMGZkMjFhOTNjNjg3YjNjNGM1MDYzMTM5OTNiNWEyYWRlODdiNzE5ZDA5NzkyYjEyMGEyN2I4NTJmNzQ5IiwgImFjciI6ICJNVUxUSV9BVVRITiJ9.pBQdgc-WGWg9fDQ5wt2xNYhCk3A83A32oDp8xDy-BvUfzRxckDSz7sUQnam2fc5Ry60wvuD1WZSf574l9a2ALzaPIjt5eR1TG2ZO8-_2eLEyJMSRqTtwRHQwz0HpUQIv9Xzo-AAYNwLniECDFSBc73ddOEKe5-kfPr9JK6tlc9MC7gtX_-rRDYyS_rhA_maI9J_mDfE9m5Pv8eV9VtvrPYDrpMi7DBnMh5xKRTLjkm6awVDy26GKPv2IpQ7-uXgFxsTQYIP-mhElZpTEmj9TQjkFVnjvJO6LkdX7TwVh6wMFgkwgGC--Y-i7gqMgxuTK4wmhIB3CeScKUfrOqzzSEA', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'token_type': 'Bearer'}
2018-04-17 14:08:58,188 oicServer:INFO PATH: "static/jwks.json"
2018-04-17 14:08:58,188 oicServer:INFO [static]sending: static/jwks.json
2018-04-17 14:08:58,203 oicServer:INFO PATH: "userinfo"
2018-04-17 14:08:58,203 oicServer:INFO callback: <bound method Application.userinfo of <__main__.Application object at 0x7ff7af9e57b8>>
2018-04-17 14:08:58,203 oic.oic:DEBUG Found 0 verify keys
2018-04-17 14:08:58,203 oic.oic.provider:DEBUG user_info_request: {'access_token': '<REDACTED>'}
2018-04-17 14:08:58,203 oicServer:DEBUG access_token type: 'T'
2018-04-17 14:08:58,204 oic.oic:DEBUG authzreq: {'acr_values': 'MULTI_AUTHN', 'nonce': 'uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i', 'response_type': 'code', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'scope': 'openid profile email address phone', 'client_id': 'cbaWz5g0uezd', 'upm_answer': 'true', 'redirect_uri': 'http://localhost:8666/authz_cb'}
2018-04-17 14:08:58,204 oic.oic.provider:DEBUG userinfo_claim: {'gender': None, 'nickname': None, 'picture': None, 'phone_number_verified': None, 'name': None, 'middle_name': None, 'sub': None, 'address': None, 'profile': None, 'locale': None, 'email': None, 'email_verified': None, 'given_name': None, 'website': None, 'zoneinfo': None, 'family_name': None, 'phone_number': None, 'updated_at': None, 'preferred_username': None, 'birthdate': None}
2018-04-17 14:08:58,205 oic.oic.provider:DEBUG Session info: {'id_token': 'eyJraWQiOiJvcDEiLCJhbGciOiJSUzI1NiJ9.eyJub25jZSI6ICJ1Q1J6RkpaVDJUM3VPZGVTdlBVT0tWMlRsdUFDUWs1aSIsICJpYXQiOiAxNTIzOTcwNTM4LCAiaXNzIjogImh0dHBzOi8vbG9jYWxob3N0OjgwOTIvIiwgImV4cCI6IDE1MjQwNTY5MzgsICJhdWQiOiBbImNiYVd6NWcwdWV6ZCJdLCAiYXV0aF90aW1lIjogMTUyMzk3MDUzOCwgInN1YiI6ICJhOTAxMGZkMjFhOTNjNjg3YjNjNGM1MDYzMTM5OTNiNWEyYWRlODdiNzE5ZDA5NzkyYjEyMGEyN2I4NTJmNzQ5IiwgImFjciI6ICJNVUxUSV9BVVRITiJ9.pBQdgc-WGWg9fDQ5wt2xNYhCk3A83A32oDp8xDy-BvUfzRxckDSz7sUQnam2fc5Ry60wvuD1WZSf574l9a2ALzaPIjt5eR1TG2ZO8-_2eLEyJMSRqTtwRHQwz0HpUQIv9Xzo-AAYNwLniECDFSBc73ddOEKe5-kfPr9JK6tlc9MC7gtX_-rRDYyS_rhA_maI9J_mDfE9m5Pv8eV9VtvrPYDrpMi7DBnMh5xKRTLjkm6awVDy26GKPv2IpQ7-uXgFxsTQYIP-mhElZpTEmj9TQjkFVnjvJO6LkdX7TwVh6wMFgkwgGC--Y-i7gqMgxuTK4wmhIB3CeScKUfrOqzzSEA', 'code': '<REDACTED>', 'access_token': '<REDACTED>', 'redirect_uri': 'http://localhost:8666/authz_cb', 'authzreq': '{"acr_values": "MULTI_AUTHN", "nonce": "uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i", "response_type": "code", "state": "QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4", "scope": "openid profile email address phone", "client_id": "cbaWz5g0uezd", "upm_answer": "true", "redirect_uri": "http://localhost:8666/authz_cb"}', 'oauth_state': 'token', 'sub': 'a9010fd21a93c687b3c4c506313993b5a2ade87b719d09792b120a27b852f749', 'code_used': True, 'nonce': 'uCRzFJZT2T3uOdeSvPUOKV2TluACQk5i', 'revoked': False, 'response_type': ['code'], 'permission': '', 'authn_event': <oic.utils.sdb.AuthnEvent object at 0x7ff7af9c07f0>, 'scope': ['openid', 'profile', 'email', 'address', 'phone'], 'access_token_scope': '?', 'state': 'QsLJm1oehQoEgnpf2lziFRQTgQSJCHQ4', 'token_type': 'Bearer', 'client_id': 'cbaWz5g0uezd'}
2018-04-17 14:08:58,205 oic.oic.provider:DEBUG user_info_response: {'sub': 'a9010fd21a93c687b3c4c506313993b5a2ade87b719d09792b120a27b852f749'}
DOBLE FACTOR Y SUCCES!